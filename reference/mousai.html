
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Harmonic Balance Tools (mousai.har_bal) &#8212; Mousai 0.2.3 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Revision History" href="revision_history.html" />
    <link rel="prev" title="Reference" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="harmonic-balance-tools-mousai-har-bal">
<h1>Harmonic Balance Tools (<code class="xref py py-mod docutils literal"><span class="pre">mousai.har_bal</span></code>)<a class="headerlink" href="#harmonic-balance-tools-mousai-har-bal" title="Permalink to this headline">¶</a></h1>
<span class="target" id="module-har_bal"></span><dl class="function">
<dt id="har_bal.harmonic_deriv">
<code class="descclassname">har_bal.</code><code class="descname">harmonic_deriv</code><span class="sig-paren">(</span><em>omega</em>, <em>r</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/har_bal.html#harmonic_deriv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#har_bal.harmonic_deriv" title="Permalink to this definition">¶</a></dt>
<dd><p>Derivative of a harmonic function using frequency methods.</p>
<p>Returns the derivatives of a harmonic function</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>omega: float</strong></p>
<blockquote>
<div><p>Fundamendal frequency, in rad/sec, of repeating signal</p>
</div></blockquote>
<p><strong>r: array_like</strong></p>
<blockquote>
<div><div class="line-block">
<div class="line">Array of rows of time histories to take the derivative of.</div>
<div class="line">The 1 axis (each row) corresponds to a time history.</div>
<div class="line">The length of the time histories <em>must be an odd integer</em>.</div>
</div>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">s: array_like</p>
<blockquote class="last">
<div><p>Function derivatives.
The 1 axis (each row) corresponds to a time history.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>At this time, the length of the time histories <em>must be an odd integer</em>.</p>
<p class="rubric">Examples</p>
<p>(<a class="reference external" href="../reference/mousai-1.py">Source code</a>, <a class="reference external" href="../reference/mousai-1.png">png</a>, <a class="reference external" href="../reference/mousai-1.hires.png">hires.png</a>, <a class="reference external" href="../reference/mousai-1.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/mousai-1.png" src="../_images/mousai-1.png" />
</div>
</dd></dl>

<dl class="function">
<dt id="har_bal.hb_so">
<code class="descclassname">har_bal.</code><code class="descname">hb_so</code><span class="sig-paren">(</span><em>sdfunc</em>, <em>x0=None</em>, <em>omega=1</em>, <em>method='newton_krylov'</em>, <em>num_harmonics=1</em>, <em>num_variables=None</em>, <em>eqform='second_order'</em>, <em>params={}</em>, <em>realify=True</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/har_bal.html#hb_so"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#har_bal.hb_so" title="Permalink to this definition">¶</a></dt>
<dd><p>Harmonic balance solver for second order ODEs.</p>
<p>Obtains the solution of a second-order differential equation under the
presumption that the solution is harmonic.</p>
<p>Returns t (time), x (displacement), v (velocity), and a (acceleration)
response of a second order linear ordinary differential
equation defined by
<span class="math">\(\ddot{\mathbf{x}}=f(\mathbf{x},\mathbf{v},\omega)\)</span> or
<span class="math">\(\dot{\mathbf{x}}=f(\mathbf{x},\omega)\)</span>.</p>
<p>For the state space form, the function <code class="docutils literal"><span class="pre">sdfunc</span></code> should have the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">duff_osc_ss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>  <span class="c1"># params is a dictionary of parameters</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]</span>  <span class="c1"># `omega` will be put into the dictionary</span>
                             <span class="c1"># for you</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cur_time&#39;</span><span class="p">]</span>   <span class="c1"># The time value is available as</span>
                             <span class="c1"># `cur_time` in the dictionary</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-.</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="o">-.</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="o">*</span><span class="n">t</span><span class="p">)]])</span>
</pre></div>
</div>
<p>In a state space form solution, the function must take the states and the
<code class="docutils literal"><span class="pre">params</span></code> dictionary. This dictionary should be used to obtain the
prescribed response frequency and the current time. These plus any other
parameters are used to calculate the state derivatives which are returned
by the function.</p>
<p>For the second order form the function <code class="docutils literal"><span class="pre">sdfunc</span></code> should have the form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">duff_osc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>  <span class="c1"># params is a dictionary of parameters</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;omega&#39;</span><span class="p">]</span>  <span class="c1"># `omega` will be put into the dictionary</span>
                             <span class="c1"># for you</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;cur_time&#39;</span><span class="p">]</span>   <span class="c1"># The time value is available as</span>
                             <span class="c1"># `cur_time` in the dictionary</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="n">x</span><span class="o">-.</span><span class="mi">1</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span><span class="o">-.</span><span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="o">+</span><span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="o">*</span><span class="n">t</span><span class="p">)]])</span>
</pre></div>
</div>
<p>In a second-order form solution the function must take the states and the
<code class="docutils literal"><span class="pre">params</span></code> dictionary. This dictionary should be used to obtain the
prescribed response frequency and the current time. These plus any other
parameters are used to calculate the state derivatives which are returned
by the function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>sdfunc: function</strong></p>
<blockquote>
<div><p>For <code class="docutils literal"><span class="pre">eqform='first_order'</span></code>, name of function that returns <strong>column
vector</strong> first derivative given <cite>x</cite>, omega and **kwargs. This is
<em>NOT</em> a string.</p>
<p><span class="math">\(\dot{\mathbf{x}}=f(\mathbf{x},\omega)\)</span></p>
<p>For <code class="docutils literal"><span class="pre">eqform='second_order'</span></code>, name of function that returns <strong>column
vector</strong> second derivative given <cite>x</cite>, <cite>v</cite>, omega and **kwargs. This
is <em>NOT</em> a string.</p>
<p><span class="math">\(\ddot{\mathbf{x}}=f(\mathbf{x},\mathbf{v},\omega)\)</span></p>
</div></blockquote>
<p><strong>x0: array_like, optional</strong></p>
<blockquote>
<div><p>n x m array where n is the number of equations and m is the number of
values representing the repeating solution.
It is required that <span class="math">\(m = 1 + 2 num_{harmonics}\)</span>. (we will
generalize allowable default values later.)</p>
</div></blockquote>
<p><strong>omega:  float</strong></p>
<blockquote>
<div><p>assumed fundamental response frequency in radians per second.</p>
</div></blockquote>
<p><strong>method: str</strong></p>
<blockquote>
<div><p>Name of optimization method to be used.</p>
</div></blockquote>
<p><strong>num_harmonics: int, optional</strong></p>
<blockquote>
<div><p>Number of harmonics to presume. The omega = 0 constant term is always
presumed to exist. Minimum (and default) is 1. If num_harmonics*2+1
exceeds the number of columns of x0 then x0 will be expanded, using
Fourier analaysis, to include additional harmonics with the starting
presumption of zero values.</p>
</div></blockquote>
<p><strong>num_variables: int, optional</strong></p>
<blockquote>
<div><p>Number of states for a state space model, or number of generalized
dispacements for a second order form.
If x0 is defined, num_variables is inferred. An error will result if
both x0 and num_variables are left out of the function call.</p>
</div></blockquote>
<p><strong>eqform: str</strong></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">second_order</span></code> or <code class="docutils literal"><span class="pre">first_order</span></code>.</p>
</div></blockquote>
<p><strong>params: dict</strong></p>
<blockquote>
<div><p>Dictionary of parameters needed by sdfunc.</p>
</div></blockquote>
<p><strong>realify: boolean</strong></p>
<blockquote>
<div><p>Force the returned results to be real.</p>
</div></blockquote>
<p><strong>other: any</strong></p>
<blockquote>
<div><p>Other keyword arguments available to nonlinear solvers in
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.nonlin.html">scipy.optimize.nonlin</a>.
See Notes.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">t, x, e, amps, phases: array_like</p>
<blockquote>
<div><p>time, displacement history (time steps along columns), errors,</p>
</div></blockquote>
<p><strong>amps</strong> : float array</p>
<blockquote>
<div><p>amplitudes of displacement (primary harmonic) in column vector format.</p>
</div></blockquote>
<p><strong>phases</strong> : float array</p>
<blockquote class="last">
<div><p>amplitudes of displacement (primary harmonic) in column vector format.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>Calls a linear algebra function from
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/optimize.nonlin.html">scipy.optimize.nonlin</a> with
<code class="docutils literal"><span class="pre">newton_krylov</span></code> as the default.</p>
<p>Benefits from quasi-linear estimator for starting point.</p>
<p>Should gently “walk” solution up to get to nonlinearities.</p>
<dl class="docutils">
<dt>Algorithm:</dt>
<dd><ol class="first last arabic simple">
<li>calls <cite>hb_so_err</cite> with x as the variable to solve for.</li>
<li><cite>hb_so_err</cite> uses a Fourier representation of x to obtain velocities
(after an inverse fft) then calls <cite>sdfunc</cite> to determine
accelerations.</li>
<li>Accelerations are also obtained using a Fourier representation of x</li>
<li>Error in the accelerations are the functional error used by the
nonlinear algebraic solver (default <code class="docutils literal"><span class="pre">newton_krylov</span></code>) to be
minimized by the solver.</li>
</ol>
</dd>
</dl>
<p>Options to the nonlinear solvers can be passed in by **kwargs.</p>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mousai</span> <span class="k">as</span> <span class="nn">ms</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">phases</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">hb_so</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">duff_osc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]]),</span> <span class="o">.</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="har_bal.solmf">
<code class="descclassname">har_bal.</code><code class="descname">solmf</code><span class="sig-paren">(</span><em>x</em>, <em>v</em>, <em>M</em>, <em>C</em>, <em>K</em>, <em>F</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/har_bal.html#solmf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#har_bal.solmf" title="Permalink to this definition">¶</a></dt>
<dd><p>Acceleration of second order linear matrix system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>x, v, F</strong> : array_like</p>
<blockquote>
<div><p><span class="math">\(n\times 1\)</span> arrays of current displacement, velocity, and Force.</p>
</div></blockquote>
<p><strong>M, C, K</strong> : array_like</p>
<blockquote>
<div><p>Mass, damping, and stiffness matrices.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>a</strong> : array_like</p>
<blockquote class="last">
<div><p><span class="math">\(n\times 1\)</span> acceleration vector</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Examples</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">M</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">K</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">10</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">F</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">solmf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">    [[-0.95]</span>
<span class="go">     [ 1.6 ]]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="har_bal.time_history">
<code class="descclassname">har_bal.</code><code class="descname">time_history</code><span class="sig-paren">(</span><em>t</em>, <em>x</em>, <em>realify=True</em>, <em>num_time_points=200</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/har_bal.html#time_history"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#har_bal.time_history" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate refined time history from harmonic balance solution.</p>
<p>Harmonic balance solutions presume a limited number of harmonics in the
solution. The result is that the time history is usually a very limited
number of values. Plotting these results implies that the solution isn’t
actually a continuous one. This function fills in the gaps using the
harmonics obtained in the solution.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>t: array_like</strong></p>
<blockquote>
<div><p>1 x m array where m is the number of
values representing the repeating solution.</p>
</div></blockquote>
<p><strong>x: array_like</strong></p>
<blockquote>
<div><p>n x m array where m is the number of equations and m is the number of
values representing the repeating solution.</p>
</div></blockquote>
<p><strong>realify: boolean</strong></p>
<blockquote>
<div><p>Force the returned results to be real.</p>
</div></blockquote>
<p><strong>num_time_points: int</strong></p>
<blockquote>
<div><p>number of points desired in the “smooth” time history.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">t: array_like</p>
<blockquote>
<div><p>1 x num_time_points array.</p>
</div></blockquote>
<p>x: array_like</p>
<blockquote class="last">
<div><p>n x num_time_points array.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>The implication of this function is that the higher harmonics that
were not determined in the solution are zero. This is indeed the assumption
made when setting up the harmonic balance solution. Whether this is a valid
assumption is something that the user must judge when performing the
solution.</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Mousai</a></h1>



<p class="blurb">Harmonic Balance Solvers</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/reference/mousai.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Joseph C. Slater.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/reference/mousai.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>